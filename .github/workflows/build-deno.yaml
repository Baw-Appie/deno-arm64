name: build-deno

# https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows
on:
  release:
    types: [created]

# https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobs
jobs:
  release:
    # https://github.com/actions/virtual-environments/blob/main/images/linux/Ubuntu2004-README.md
    runs-on: ubuntu-latest
    outputs:
      upload_url: ${{ steps.get_upload_url.upload_url }}
    steps:
      - name: get_upload_url
        run: |
          url=$(curl -s -H "Accept: application/json" https://api.github.com/repos/lukechannings/docker-deno/releases | jq -r '.[]|select(.tag_name=="${GITHUB_REF}").upload_url')
          echo "::set-output name=upload_url::${url}"
  test:
    runs-on: ubuntu-latest
    needs: release
    steps:
      - run: |
          echo "Upload URL: ${{ needs.release.outputs.upload_url }}"

